(function($,window,undefined){var $event=$.event,$special,resizeTimeout;$special=$event.special.debouncedresize={setup:function(){$(this).on("resize",$special.handler)},teardown:function(){$(this).off("resize",$special.handler)},handler:function(event,execAsap){var context=this,args=arguments,dispatch=function(){event.type="debouncedresize";$event.dispatch.apply(context,args)};if(resizeTimeout){clearTimeout(resizeTimeout)}execAsap?dispatch():resizeTimeout=setTimeout(dispatch,$special.threshold)},threshold:50};var $window=$(window),Modernizr=window.Modernizr;$.PFold=function(options,element){this.$el=$(element);this._init(options)};$.PFold.defaults={perspective:1200,speed:450,easing:"linear",folddelay:0,folds:2,folddirection:["right","top"],overlays:true,centered:false,containerSpeedFactor:1,containerEasing:"linear",onEndFolding:function(){return false},onEndUnfolding:function(){return false}};$.PFold.prototype={_init:function(options){this.options=$.extend(true,{},$.PFold.defaults,options);this.transEndEventNames={"WebkitTransition":"webkitTransitionEnd","MozTransition":"transitionend","OTransition":"oTransitionEnd","msTransition":"MSTransitionEnd","transition":"transitionend"};this.transEndEventName=this.transEndEventNames[Modernizr.prefixed("transition")];this.support=Modernizr.csstransitions&&Modernizr.csstransforms3d;if(this.support){this.$el.css("perspective",this.options.perspective+"px");this.$el.css("transition","all "+(this.options.speed*this.options.folds*this.options.containerSpeedFactor)+"ms "+this.options.containerEasing)}this.initialDim={width:this.$el.width(),height:this.$el.height(),left:0,top:0};this._layout();this.$iContent=this.$el.find(".uc-initial");this.iContent=this.$iContent.html();this.$fContent=this.$el.find(".uc-final");this.fContent=this.$fContent.html();this.$finalEl=$('<div class="uc-final-wrapper"></div>').append(this.$iContent.clone().hide(),this.$fContent).hide();this.$el.append(this.$finalEl);this._setDimOffset();this.opened=false;this.animating=false;this._initEvents()},_layout:function(){var $initialContentEl=this.$el.children("div.uc-initial-content"),finalDim=this._getFinalDim(),$finalContentEl=this.$el.children("div.uc-final-content").css({width:finalDim.width,height:finalDim.height});$initialContentEl.wrap('<div class="uc-initial"></div>');$finalContentEl.show().wrap($('<div class="uc-final"></div>'))},_initEvents:function(){var self=this;$window.on("debouncedresize.pfold",function(event){self._setDimOffset()})},_setDimOffset:function(){this.initialDim.offsetL=this.$el.offset().left-$window.scrollLeft();this.initialDim.offsetT=this.$el.offset().top-$window.scrollTop();this.initialDim.offsetR=$window.width()-this.initialDim.offsetL-this.initialDim.width;this.initialDim.offsetB=$window.height()-this.initialDim.offsetT-this.initialDim.height},_getTranslationValue:function(){var x=0,y=0,horizTimes=0,vertTimes=0;for(var i=0;i<this.options.folds;++i){var dir=this.options.folddirection[i]||"bottom";switch(dir){case"left":x+=this.initialDim.width*Math.pow(2,horizTimes)/2;horizTimes+=1;break;case"right":x-=this.initialDim.width*Math.pow(2,horizTimes)/2;horizTimes+=1;break;case"top":y+=this.initialDim.height*Math.pow(2,vertTimes)/2;vertTimes+=1;break;case"bottom":y-=this.initialDim.height*Math.pow(2,vertTimes)/2;vertTimes+=1;break}}return{x:x,y:y}},_getAccumulatedValue:function(){var l=0,r=0,t=0,b=0,horizTimes=0,vertTimes=0;for(var i=0;i<this.options.folds;++i){var dir=this.options.folddirection[i]||"bottom";switch(dir){case"left":l+=this.initialDim.width*Math.pow(2,horizTimes);horizTimes+=1;break;case"right":r+=this.initialDim.width*Math.pow(2,horizTimes);horizTimes+=1;break;case"top":t+=this.initialDim.height*Math.pow(2,vertTimes);vertTimes+=1;break;case"bottom":b+=this.initialDim.height*Math.pow(2,vertTimes);vertTimes+=1;break}}return{l:l,r:r,t:t,b:b}},_getFinalDim:function(){var l=0,r=0,t=0,b=0,horizTimes=0,vertTimes=0;for(var i=0;i<this.options.folds;++i){var dir=this.options.folddirection[i]||"bottom";switch(dir){case"left":case"right":horizTimes+=1;break;case"top":case"bottom":vertTimes+=1;break}}return{width:this.initialDim.width*Math.pow(2,horizTimes),height:this.initialDim.height*Math.pow(2,vertTimes)}},_updateStepStyle:function(action){var w,h,l,t;if(action==="fold"){w=this.lastDirection==="left"||this.lastDirection==="right"?this.lastStyle.width/2:this.lastStyle.width,h=this.lastDirection==="left"||this.lastDirection==="right"?this.lastStyle.height:this.lastStyle.height/2,l=this.lastDirection==="left"?this.lastStyle.left+this.lastStyle.width/2:this.lastStyle.left,t=this.lastDirection==="top"?this.lastStyle.top+this.lastStyle.height/2:this.lastStyle.top}else{w=this.lastDirection==="left"||this.lastDirection==="right"?this.lastStyle.width*2:this.lastStyle.width,h=this.lastDirection==="left"||this.lastDirection==="right"?this.lastStyle.height:this.lastStyle.height*2,l=this.lastDirection==="left"?this.lastStyle.left-this.lastStyle.width:this.lastStyle.left,t=this.lastDirection==="top"?this.lastStyle.top-this.lastStyle.height:this.lastStyle.top
    }return{width:w,height:h,left:l,top:t}},_getOppositeDirection:function(realdirection){var rvd;switch(realdirection){case"left":rvd="right";break;case"right":rvd="left";break;case"top":rvd="bottom";break;case"bottom":rvd="top";break}return rvd},_start:function(action,step){step|=0;var self=this,styleCSS=(action==="fold")?{width:this.lastStyle.width,height:this.lastStyle.height,left:this.lastStyle.left,top:this.lastStyle.top}:this.initialDim,contentTopFront="",contentBottom="",contentTopBack="",direction=(action==="fold")?this.options.folddirection[this.options.folds-1-step]||"bottom":this.options.folddirection[step]||"bottom",nextdirection=(action==="fold")?this.options.folddirection[this.options.folds-2-step]||"bottom":"";this.$el.find("div.uc-part").remove();switch(step){case 0:case this.options.folds-1:if(action==="fold"){if(step===this.options.folds-1){styleCSS=this.initialDim;contentTopFront=this.iContent}if(step===0){this._setDimOffset();this.$el.css({left:0,top:0});var content=this._setLastStep(direction,styleCSS),contentBottom=content.bottom,contentTopBack=content.top;this.$finalEl.hide().children().hide()}}else{if(step===0){this._setDimOffset();var coords=this._getTranslationViewport();this.$el.addClass("uc-current").css({left:coords.ftx,top:coords.fty});contentTopFront=this.iContent;this.$finalEl.hide().children().hide()}else{styleCSS=this._updateStepStyle(action)}if(step===this.options.folds-1){var content=this._setLastStep(direction,styleCSS),contentBottom=content.bottom,contentTopBack=content.top}}break;case this.options.folds:styleCSS=(action==="fold")?this.initialDim:this._updateStepStyle(action);var contentIdx=(action==="fold")?0:1;this.$el.find(".uc-part").remove();this.$finalEl.css(styleCSS).show().children().eq(contentIdx).show();this.opened=(action==="fold")?false:true;this.animating=false;if(action==="fold"){this.$el.removeClass("uc-current");this.options.onEndFolding()}else{this.options.onEndUnfolding()}return false;break;default:styleCSS=this._updateStepStyle(action);break}if(this.support){styleCSS.transition="all "+this.options.speed+"ms "+this.options.easing}var unfoldClass="uc-unfold-"+direction,topElClasses=(action==="fold")?"uc-unfold uc-part "+unfoldClass:"uc-part "+unfoldClass,$topEl=$('<div class="'+topElClasses+'"><div class="uc-front">'+contentTopFront+'</div><div class="uc-back">'+contentTopBack+"</div></div>").css(styleCSS),$bottomEl=$('<div class="uc-part uc-single">'+contentBottom+"</div>").css(styleCSS);this.lastDirection=(action==="fold")?nextdirection:direction;this.lastStyle=styleCSS;this.$el.append($bottomEl,$topEl);if(this.options.overlays&&this.support){this._addOverlays(action,$bottomEl,$topEl)}setTimeout(function(){(action==="fold")?$topEl.removeClass("uc-unfold"):$topEl.addClass("uc-unfold");if(self.support){$topEl.on(self.transEndEventName,function(event){if(event.target.className!=="uc-flipoverlay"&&step<self.options.folds){setTimeout(function(){self._start(action,step+1)},self.options.folddelay)}})}else{self._start(action,step+1)}if(self.options.overlays&&self.support){var bo=(action==="fold")?1:0,tbo=(action==="fold")?0.5:0,tfo=(action==="fold")?0:0.5;self.$bottomOverlay.css("opacity",bo);self.$topBackOverlay.css("opacity",tbo);self.$topFrontOverlay.css("opacity",tfo)}},30)},_getTranslationViewport:function(){var accumulatedValues=this._getAccumulatedValue(),tx=0,ty=0;this.fOffsetL=this.initialDim.offsetL-accumulatedValues.l;this.fOffsetT=this.initialDim.offsetT-accumulatedValues.t;this.fOffsetR=this.initialDim.offsetR-accumulatedValues.r;this.fOffsetB=this.initialDim.offsetB-accumulatedValues.b;if(this.fOffsetL<0){tx=Math.abs(this.fOffsetL)}if(this.fOffsetT<0){ty=Math.abs(this.fOffsetT)}if(this.fOffsetR<0){tx-=Math.abs(this.fOffsetR)}if(this.fOffsetB<0){ty-=Math.abs(this.fOffsetB)}var ftx=tx,fty=ty;if(this.options.centered){var translationValue=this._getTranslationValue();if(translationValue.x>0&&this.fOffsetR+translationValue.x>=0){ftx=(this.fOffsetL>=0)?Math.min(translationValue.x,this.fOffsetR):translationValue.x+(tx-translationValue.x)}else{if(translationValue.x<0&&this.fOffsetL+translationValue.x>=0){ftx=(this.fOffsetR>=0)?Math.min(translationValue.x,this.fOffsetL):translationValue.x+(tx-translationValue.x)}else{ftx=translationValue.x+(tx-translationValue.x)}}if(translationValue.y>0&&this.fOffsetB+translationValue.y>=0){fty=(this.fOffsetT>=0)?Math.min(translationValue.y,this.fOffsetB):translationValue.y+(ty-translationValue.y)}else{if(translationValue.y<0&&this.fOffsetT+translationValue.y>=0){fty=(this.fOffsetB>=0)?Math.min(translationValue.y,this.fOffsetT):translationValue.y+(ty-translationValue.y)}else{fty=translationValue.y+(ty-translationValue.y)}}}return{ftx:ftx,fty:fty}},_setLastStep:function(direction,styleCSS){var contentBottom,contentTopBack,contentBottomStyle="",contentTopBackStyle="";switch(direction){case"bottom":contentTopBackStyle="margin-top: -"+styleCSS.height+"px";break;case"top":contentBottomStyle="margin-top: -"+styleCSS.height+"px";break;
        case"left":contentTopBackStyle="width:"+(styleCSS.width*2)+"px";contentBottomStyle="width:"+(styleCSS.width*2)+"px;margin-left: -"+styleCSS.width+"px";break;case"right":contentTopBackStyle="with:"+(styleCSS.width*2)+"px;margin-left: -"+styleCSS.width+"px";contentBottomStyle="width:"+(styleCSS.width*2)+"px";break}contentBottom='<div class="uc-inner"><div class="uc-inner-content" style="'+contentBottomStyle+'">'+this.fContent+"</div></div>";var contentTopBackClasses=direction==="top"||direction==="bottom"?"uc-inner uc-inner-rotate":"uc-inner";contentTopBack='<div class="'+contentTopBackClasses+'"><div class="uc-inner-content" style="'+contentTopBackStyle+'">'+this.fContent+"</div></div>";return{bottom:contentBottom,top:contentTopBack}},_addOverlays:function(action,$bottomEl,$topEl){var bottomOverlayStyle,topFrontOverlayStyle,topBackOverlayStyle;this.$bottomOverlay=$('<div class="uc-overlay"></div>');this.$topFrontOverlay=$('<div class="uc-flipoverlay"></div>');this.$topBackOverlay=$('<div class="uc-flipoverlay"></div>');if(action==="fold"){bottomOverlayStyle={transition:"opacity "+(this.options.speed/2)+"ms "+this.options.easing+" "+(this.options.speed/2)+"ms"};topFrontOverlayStyle={opacity:0.5,transition:"opacity "+(this.options.speed/2)+"ms "+this.options.easing};topBackOverlayStyle={opacity:0,transition:"opacity "+(this.options.speed/2)+"ms "+this.options.easing}}else{bottomOverlayStyle={opacity:1,transition:"opacity "+(this.options.speed/2)+"ms "+this.options.easing};topFrontOverlayStyle={transition:"opacity "+(this.options.speed/2)+"ms "+this.options.easing};topBackOverlayStyle={opacity:0.5,transition:"opacity "+(this.options.speed/2)+"ms "+this.options.easing+" "+(this.options.speed/2)+"ms"}}$bottomEl.append(this.$bottomOverlay.css(bottomOverlayStyle));$topEl.children("div.uc-front").append(this.$topFrontOverlay.css(topFrontOverlayStyle)).end().children("div.uc-back").append(this.$topBackOverlay.css(topBackOverlayStyle))},unfold:function(){if(this.opened||this.animating){return false}this.animating=true;this._start("unfold")},fold:function(){if(!this.opened||this.animating){return false}this.animating=true;this._start("fold")},getStatus:function(){return(this.opened)?"opened":"closed"}};var logError=function(message){if(window.console){window.console.error(message)}};$.fn.pfold=function(options){var instance=$.data(this,"pfold");if(typeof options==="string"){var args=Array.prototype.slice.call(arguments,1);this.each(function(){if(!instance){logError("cannot call methods on pfold prior to initialization; "+"attempted to call method '"+options+"'");return}if(!$.isFunction(instance[options])||options.charAt(0)==="_"){logError("no such method '"+options+"' for pfold instance");return}instance[options].apply(instance,args)})}else{this.each(function(){if(instance){instance._init()}else{instance=$.data(this,"pfold",new $.PFold(options,this))}})}return instance}})(jQuery,window);